{"ast":null,"code":"var _jsxFileName = \"/Users/mac/Documents/Doantotnghiep/Doantotnghiep/EKwebsite/frontend/src/components/UI/UploadButton/index.js\",\n  _s = $RefreshSig$();\nimport Button from '@material-ui/core/Button';\nimport CloudUploadIcon from '@material-ui/icons/CloudUpload';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport Skeleton from '@material-ui/lab/Skeleton';\nimport Compressor from 'compressorjs';\nimport { MAX } from 'constant';\nimport PropTypes from 'prop-types';\nimport React, { useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { setMessage } from 'redux/slices/message.slice';\nimport useStyle from './style';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction checkFile(file) {\n  if (!file) return {\n    status: false,\n    message: 'File không hợp lệ'\n  };\n  const {\n    type,\n    size\n  } = file;\n  if (type.split('/')[0] !== 'image') return {\n    status: false,\n    message: 'File gửi lên phải là một ảnh'\n  };\n  if (size / 1024 ** 2 > MAX.IMG_SIZE) return {\n    status: false,\n    message: `Kích thước của ảnh tối đa là ${MAX.IMG_SIZE} MB`\n  };\n  return {\n    status: true\n  };\n}\nfunction UploadButton(_ref) {\n  _s();\n  var _state$data, _state$data2, _state$data3;\n  let {\n    title,\n    className,\n    onChange,\n    resetFlag\n  } = _ref;\n  const classes = useStyle();\n  const dispatch = useDispatch();\n  const [state, setState] = useState({\n    status: 0,\n    data: null\n  });\n  useEffect(() => {\n    if (!resetFlag) return;\n    // reset value if parent component reset, except first render\n    setState({\n      status: 0,\n      data: null\n    });\n  }, [resetFlag]);\n  const loadFileError = () => {\n    onChange(null);\n    setState({\n      status: 0\n    });\n    dispatch(setMessage({\n      type: 'error',\n      message: 'Tải tập tin thất bại, thử lại'\n    }));\n  };\n  const onFileChange = file => {\n    const {\n      status,\n      message = ''\n    } = checkFile(file);\n    if (!status) {\n      dispatch(setMessage({\n        type: 'error',\n        message\n      }));\n      onChange(null);\n      return;\n    }\n    setState({\n      status: 1\n    }); // loading\n    const size = file.size / 1024 ** 2;\n\n    // compress image\n    new Compressor(file, {\n      quality: size > 1 ? 0.6 : 0.8,\n      success(fileResult) {\n        const fileReader = new FileReader();\n        fileReader.readAsDataURL(fileResult);\n        fileReader.onerror = loadFileError;\n        fileReader.onload = function (e) {\n          const imgSrcBase64 = e.target.result;\n          onChange(imgSrcBase64);\n          setState({\n            status: 2,\n            data: {\n              imgSrc: imgSrcBase64,\n              fileName: fileResult.name,\n              fileSize: (fileResult.size / 1024 ** 2).toFixed(2)\n            }\n          });\n        };\n      },\n      error() {\n        loadFileError();\n      }\n    });\n  };\n  const onRemoveFile = () => {\n    onChange(null);\n    setState({\n      status: 0,\n      data: null\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: className,\n    children: [state.status === 0 && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        className: classes.input,\n        accept: \"image/*\",\n        id: \"button-file\",\n        htmlFor: \"contained-button-file\",\n        type: \"file\",\n        onChange: e => onFileChange(e.target.files[0])\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"button-file\",\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          className: `${classes.btn} w-100 h-100`,\n          variant: \"contained\",\n          color: \"primary\",\n          component: \"span\",\n          endIcon: /*#__PURE__*/_jsxDEV(CloudUploadIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 116,\n            columnNumber: 24\n          }, this),\n          children: title\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true), state.status === 1 && /*#__PURE__*/_jsxDEV(Skeleton, {\n      variant: \"rect\",\n      classes: {\n        root: classes.skeleton\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 9\n    }, this), state.status === 2 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `${classes.review} w-100 h-100 flex-center-between`,\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        src: (_state$data = state.data) === null || _state$data === void 0 ? void 0 : _state$data.imgSrc,\n        alt: \"photo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [`${(_state$data2 = state.data) === null || _state$data2 === void 0 ? void 0 : _state$data2.fileName} (${(_state$data3 = state.data) === null || _state$data3 === void 0 ? void 0 : _state$data3.fileSize} MB)`, \" \"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(DeleteIcon, {\n        className: \"icon cur-pointer\",\n        onClick: onRemoveFile\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 5\n  }, this);\n}\n_s(UploadButton, \"c9+fqLHx5w3xzD5LnMuaWgUzUF8=\", false, function () {\n  return [useStyle, useDispatch];\n});\n_c = UploadButton;\nUploadButton.propTypes = {\n  title: PropTypes.string,\n  className: PropTypes.string,\n  onChange: PropTypes.func,\n  resetFlag: PropTypes.number\n};\nUploadButton.defaultProps = {\n  title: 'Upload',\n  className: '',\n  onChange: () => {},\n  resetFlag: 0\n};\nexport default UploadButton;\nvar _c;\n$RefreshReg$(_c, \"UploadButton\");","map":{"version":3,"names":["Button","CloudUploadIcon","DeleteIcon","Skeleton","Compressor","MAX","PropTypes","React","useEffect","useState","useDispatch","setMessage","useStyle","checkFile","file","status","message","type","size","split","IMG_SIZE","UploadButton","title","className","onChange","resetFlag","classes","dispatch","state","setState","data","loadFileError","onFileChange","quality","success","fileResult","fileReader","FileReader","readAsDataURL","onerror","onload","e","imgSrcBase64","target","result","imgSrc","fileName","name","fileSize","toFixed","error","onRemoveFile","input","files","btn","root","skeleton","review","propTypes","string","func","number","defaultProps"],"sources":["/Users/mac/Documents/Doantotnghiep/Doantotnghiep/EKwebsite/frontend/src/components/UI/UploadButton/index.js"],"sourcesContent":["import Button from '@material-ui/core/Button';\nimport CloudUploadIcon from '@material-ui/icons/CloudUpload';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport Skeleton from '@material-ui/lab/Skeleton';\nimport Compressor from 'compressorjs';\nimport { MAX } from 'constant';\nimport PropTypes from 'prop-types';\nimport React, { useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { setMessage } from 'redux/slices/message.slice';\nimport useStyle from './style';\n\nfunction checkFile(file) {\n  if (!file) return { status: false, message: 'File không hợp lệ' };\n  const { type, size } = file;\n\n  if (type.split('/')[0] !== 'image')\n    return { status: false, message: 'File gửi lên phải là một ảnh' };\n\n  if (size / 1024 ** 2 > MAX.IMG_SIZE)\n    return {\n      status: false,\n      message: `Kích thước của ảnh tối đa là ${MAX.IMG_SIZE} MB`,\n    };\n\n  return { status: true };\n}\n\nfunction UploadButton({ title, className, onChange, resetFlag }) {\n  const classes = useStyle();\n  const dispatch = useDispatch();\n  const [state, setState] = useState({ status: 0, data: null });\n\n  useEffect(() => {\n    if (!resetFlag) return;\n    // reset value if parent component reset, except first render\n    setState({ status: 0, data: null });\n  }, [resetFlag]);\n\n  const loadFileError = () => {\n    onChange(null);\n    setState({ status: 0 });\n    dispatch(\n      setMessage({\n        type: 'error',\n        message: 'Tải tập tin thất bại, thử lại',\n      }),\n    );\n  };\n\n  const onFileChange = (file) => {\n    const { status, message = '' } = checkFile(file);\n    if (!status) {\n      dispatch(setMessage({ type: 'error', message }));\n      onChange(null);\n      return;\n    }\n\n    setState({ status: 1 }); // loading\n    const size = file.size / 1024 ** 2;\n\n    // compress image\n    new Compressor(file, {\n      quality: size > 1 ? 0.6 : 0.8,\n\n      success(fileResult) {\n        const fileReader = new FileReader();\n        fileReader.readAsDataURL(fileResult);\n\n        fileReader.onerror = loadFileError;\n\n        fileReader.onload = function (e) {\n          const imgSrcBase64 = e.target.result;\n          onChange(imgSrcBase64);\n          setState({\n            status: 2,\n            data: {\n              imgSrc: imgSrcBase64,\n              fileName: fileResult.name,\n              fileSize: (fileResult.size / 1024 ** 2).toFixed(2),\n            },\n          });\n        };\n      },\n\n      error() {\n        loadFileError();\n      },\n    });\n  };\n\n  const onRemoveFile = () => {\n    onChange(null);\n    setState({ status: 0, data: null });\n  };\n\n  return (\n    <div className={className}>\n      {/* waiting */}\n      {state.status === 0 && (\n        <>\n          <input\n            className={classes.input}\n            accept=\"image/*\"\n            id=\"button-file\"\n            htmlFor=\"contained-button-file\"\n            type=\"file\"\n            onChange={(e) => onFileChange(e.target.files[0])}\n          />\n          <label htmlFor=\"button-file\">\n            <Button\n              className={`${classes.btn} w-100 h-100`}\n              variant=\"contained\"\n              color=\"primary\"\n              component=\"span\"\n              endIcon={<CloudUploadIcon />}>\n              {title}\n            </Button>\n          </label>\n        </>\n      )}\n\n      {/* loading */}\n      {state.status === 1 && (\n        <Skeleton variant=\"rect\" classes={{ root: classes.skeleton }} />\n      )}\n\n      {/* done */}\n      {state.status === 2 && (\n        <div className={`${classes.review} w-100 h-100 flex-center-between`}>\n          <img src={state.data?.imgSrc} alt=\"photo\" />\n          <p>{`${state.data?.fileName} (${state.data?.fileSize} MB)`} </p>\n          <DeleteIcon className=\"icon cur-pointer\" onClick={onRemoveFile} />\n        </div>\n      )}\n    </div>\n  );\n}\n\nUploadButton.propTypes = {\n  title: PropTypes.string,\n  className: PropTypes.string,\n  onChange: PropTypes.func,\n  resetFlag: PropTypes.number,\n};\n\nUploadButton.defaultProps = {\n  title: 'Upload',\n  className: '',\n  onChange: () => {},\n  resetFlag: 0,\n};\n\nexport default UploadButton;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}