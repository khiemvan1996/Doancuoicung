{"ast":null,"code":"var _jsxFileName = \"/Users/mac/Documents/Doantotnghiep/Doantotnghiep/EKwebsite/frontend/src/components/Flashcard/data.js\",\n  _s = $RefreshSig$();\nimport commonApi from 'apis/commonApi';\nimport flashcardApi from 'apis/flashcardApi';\nimport { equalArray } from 'helper';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { setMessage } from 'redux/slices/message.slice';\nimport Flashcard from '.';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst perPage = 7;\nfunction FlashcardData() {\n  _s();\n  const dispatch = useDispatch();\n  const list = useRef([]); // list store all item to prevent call API when prev button click\n  const [currentList, setCurrentList] = useState([]);\n  const [total, setTotal] = useState(-1);\n  const [pageInfo, setPageInfo] = useState({\n    page: 1,\n    packInfo: {\n      type: '-1',\n      level: '-1',\n      specialty: '-1',\n      topics: []\n    }\n  });\n\n  // get total word pack\n  useEffect(() => {\n    let isSubscribe = true;\n    if (total !== -1) {\n      return;\n    }\n    (async function getTotalWordPack() {\n      try {\n        const apiRes = await commonApi.getWordPackTotal(pageInfo.packInfo);\n        if (apiRes.status === 200 && isSubscribe) {\n          const {\n            total = 0\n          } = apiRes.data;\n          if (total === 0) {\n            dispatch(setMessage({\n              type: 'warning',\n              message: 'Gói từ vựng hiện tại không đủ, vui lòng thử lại sau.',\n              duration: 3000\n            }));\n          }\n          setTotal(total);\n        }\n      } catch (error) {\n        setTotal(0);\n      }\n    })();\n    return () => isSubscribe = false;\n  }, [total]);\n\n  // get word pack when page change\n  useEffect(() => {\n    let isSubscribe = true;\n    if (pageInfo.page < list.current.length / perPage) return; // prevent call API when element already exists in the old array\n\n    async function getFlashcardList() {\n      try {\n        const apiRes = await flashcardApi.getWordPack(pageInfo.page, perPage, pageInfo.packInfo);\n        if (apiRes.status === 200 && isSubscribe) {\n          const {\n            packList = []\n          } = apiRes.data;\n          setCurrentList(packList);\n          list.current = [...list.current, ...packList];\n        }\n      } catch (error) {}\n    }\n    isSubscribe && getFlashcardList();\n    return () => isSubscribe = false;\n  }, [pageInfo]);\n  const handleNextClick = () => {\n    const {\n      page\n    } = pageInfo;\n    if (page < total) {\n      if (pageInfo.page < list.current.length / perPage) {\n        const oldList = list.current.slice(page * perPage, (page + 1) * perPage);\n        setCurrentList(oldList);\n      }\n      setPageInfo({\n        ...pageInfo,\n        page: page + 1\n      });\n    }\n  };\n  const handlePrevClick = () => {\n    const {\n      page\n    } = pageInfo;\n    if (page > 1) {\n      const oldList = list.current.slice((page - 2) * perPage, (page - 1) * perPage);\n      setCurrentList(oldList);\n      setPageInfo({\n        ...pageInfo,\n        page: page - 1\n      });\n    }\n  };\n  const onWordPackChange = newPackInfo => {\n    const {\n      packInfo\n    } = pageInfo;\n\n    // check the similarity\n    let isSame = true;\n    const {\n      topics\n    } = newPackInfo;\n    isSame = equalArray(topics, packInfo.topics);\n    for (let k in packInfo) {\n      if (k !== 'topics' && packInfo[k] !== newPackInfo[k]) {\n        isSame = false;\n        break;\n      }\n    }\n    if (isSame) return;\n\n    // reset and call API\n    list.current = [];\n    setPageInfo({\n      page: 1,\n      packInfo: newPackInfo\n    });\n    setTotal(-1);\n  };\n  return /*#__PURE__*/_jsxDEV(Flashcard, {\n    list: currentList,\n    total: total,\n    currentPage: pageInfo.page,\n    onNextPage: handleNextClick,\n    onPrevPage: handlePrevClick,\n    onWordPackChange: onWordPackChange\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 137,\n    columnNumber: 5\n  }, this);\n}\n_s(FlashcardData, \"YhbWtuGXJ4u1c8JWRP8w46/JNsM=\", false, function () {\n  return [useDispatch];\n});\n_c = FlashcardData;\nexport default FlashcardData;\nvar _c;\n$RefreshReg$(_c, \"FlashcardData\");","map":{"version":3,"names":["commonApi","flashcardApi","equalArray","React","useEffect","useRef","useState","useDispatch","setMessage","Flashcard","perPage","FlashcardData","dispatch","list","currentList","setCurrentList","total","setTotal","pageInfo","setPageInfo","page","packInfo","type","level","specialty","topics","isSubscribe","getTotalWordPack","apiRes","getWordPackTotal","status","data","message","duration","error","current","length","getFlashcardList","getWordPack","packList","handleNextClick","oldList","slice","handlePrevClick","onWordPackChange","newPackInfo","isSame","k"],"sources":["/Users/mac/Documents/Doantotnghiep/Doantotnghiep/EKwebsite/frontend/src/components/Flashcard/data.js"],"sourcesContent":["import commonApi from 'apis/commonApi';\nimport flashcardApi from 'apis/flashcardApi';\nimport { equalArray } from 'helper';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { setMessage } from 'redux/slices/message.slice';\nimport Flashcard from '.';\n\nconst perPage = 7;\n\nfunction FlashcardData() {\n  const dispatch = useDispatch();\n  const list = useRef([]); // list store all item to prevent call API when prev button click\n  const [currentList, setCurrentList] = useState([]);\n  const [total, setTotal] = useState(-1);\n  const [pageInfo, setPageInfo] = useState({\n    page: 1,\n    packInfo: {\n      type: '-1',\n      level: '-1',\n      specialty: '-1',\n      topics: [],\n    },\n  });\n\n  // get total word pack\n  useEffect(() => {\n    let isSubscribe = true;\n\n    if (total !== -1) {\n      return;\n    }\n\n    (async function getTotalWordPack() {\n      try {\n        const apiRes = await commonApi.getWordPackTotal(pageInfo.packInfo);\n\n        if (apiRes.status === 200 && isSubscribe) {\n          const { total = 0 } = apiRes.data;\n          if (total === 0) {\n            dispatch(\n              setMessage({\n                type: 'warning',\n                message: 'Gói từ vựng hiện tại không đủ, vui lòng thử lại sau.',\n                duration: 3000,\n              }),\n            );\n          }\n          setTotal(total);\n        }\n      } catch (error) {\n        setTotal(0);\n      }\n    })();\n\n    return () => (isSubscribe = false);\n  }, [total]);\n\n  // get word pack when page change\n  useEffect(() => {\n    let isSubscribe = true;\n    if (pageInfo.page < list.current.length / perPage) return; // prevent call API when element already exists in the old array\n\n    async function getFlashcardList() {\n      try {\n        const apiRes = await flashcardApi.getWordPack(\n          pageInfo.page,\n          perPage,\n          pageInfo.packInfo,\n        );\n\n        if (apiRes.status === 200 && isSubscribe) {\n          const { packList = [] } = apiRes.data;\n          setCurrentList(packList);\n          list.current = [...list.current, ...packList];\n        }\n      } catch (error) {}\n    }\n\n    isSubscribe && getFlashcardList();\n\n    return () => (isSubscribe = false);\n  }, [pageInfo]);\n\n  const handleNextClick = () => {\n    const { page } = pageInfo;\n    if (page < total) {\n      if (pageInfo.page < list.current.length / perPage) {\n        const oldList = list.current.slice(\n          page * perPage,\n          (page + 1) * perPage,\n        );\n        setCurrentList(oldList);\n      }\n      setPageInfo({ ...pageInfo, page: page + 1 });\n    }\n  };\n\n  const handlePrevClick = () => {\n    const { page } = pageInfo;\n    if (page > 1) {\n      const oldList = list.current.slice(\n        (page - 2) * perPage,\n        (page - 1) * perPage,\n      );\n      setCurrentList(oldList);\n      setPageInfo({ ...pageInfo, page: page - 1 });\n    }\n  };\n\n  const onWordPackChange = (newPackInfo) => {\n    const { packInfo } = pageInfo;\n\n    // check the similarity\n    let isSame = true;\n    const { topics } = newPackInfo;\n    isSame = equalArray(topics, packInfo.topics);\n    for (let k in packInfo) {\n      if (k !== 'topics' && packInfo[k] !== newPackInfo[k]) {\n        isSame = false;\n        break;\n      }\n    }\n\n    if (isSame) return;\n\n    // reset and call API\n    list.current = [];\n    setPageInfo({\n      page: 1,\n      packInfo: newPackInfo,\n    });\n    setTotal(-1);\n  };\n\n  return (\n    <Flashcard\n      list={currentList}\n      total={total}\n      currentPage={pageInfo.page}\n      onNextPage={handleNextClick}\n      onPrevPage={handlePrevClick}\n      onWordPackChange={onWordPackChange}\n    />\n  );\n}\n\nexport default FlashcardData;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}